# Test Suite

This directory contains fast and slow tests for the koris-api project.

## Test Types

### Fast Tests (`test_api_fast.py`)
- **Runtime**: ~0.12 seconds (11 tests)
- **Purpose**: Unit tests using fixtures and mocks
- **No API calls**: All data is pre-loaded from `fixtures/` directory
- **Run with**: `uv run pytest tests/test_api_fast.py -v`

These tests:
- Test parsing logic with fixture data
- Test API methods with mocked HTTP responses
- Validate data structure and consistency
- Run very quickly and can be run frequently during development

### Integration Tests (`test_integration.py`)
- **Runtime**: ~2.8 seconds (13 tests)
- **Purpose**: Mirror fast tests but with live API data
- **Makes real API calls**: Tests same functionality with real responses
- **Run with**: `uv run pytest tests/test_integration.py -v`
- **Skip with**: `pytest -m "not integration"`

These tests:
- **Mirror the structure of fast tests** - same test coverage
- **Use session-scoped fixtures** - API calls made once per test session
- Fetch real data and test parsing with live responses
- Verify API connectivity and current data structure
- Test performance/response times
- Should be run less frequently (e.g., before releases)

## Running Tests

```bash
# Run only fast tests (recommended for development)
uv run pytest tests/test_api_fast.py -v

# Run all tests except integration tests
uv run pytest -m "not integration" -v

# Run only integration tests
uv run pytest -m "integration" -v

# Run all tests (fast + slow)
uv run pytest tests/ -v

# Run a specific test
uv run pytest tests/test_api_fast.py::test_boxscore_parsing_from_html -v
```

## Test Fixtures

Test fixtures are stored in `tests/fixtures/` and generated by `generate_fixtures.py`:

```
tests/fixtures/
├── basketfi/           # Basket.fi API responses
│   ├── matches.json    # Full season matches
│   ├── match_detail.json
│   ├── team.json
│   └── category.json
└── genius_sports/      # Genius Sports API responses
    ├── boxscore.json   # One match boxscore
    └── teams.json      # Teams for one competition
```

### Regenerating Fixtures

If the API responses change or you want to update test data:

```bash
python3 tests/generate_fixtures.py
```

This will fetch fresh data from the live APIs and save it to the fixtures directory.

## Comparison: Old vs New Tests

### Old Tests (test_api.py)
- ❌ **Slow**: 30-60 seconds or more
- ❌ **All fetch full season data**: Every test hits live APIs
- ❌ **Genius Sports calls very slow**: Multiple seconds per player
- ❌ **Concurrent downloads**: Tests entire download pipeline
- ❌ **Network dependent**: Fails if API is down

### New Tests
- ✅ **Fast tests**: 0.12 seconds (11 tests with fixtures)
- ✅ **Integration tests**: 2.8 seconds (13 tests with live API)
- ✅ **Session-scoped fixtures**: API calls made once per session
- ✅ **Same test coverage**: Integration tests mirror fast tests
- ✅ **Efficient**: Tests reuse live data across multiple test functions
- ✅ **Reliable**: Fast tests don't depend on network

## Migration from Old Tests

The old `test_api.py` file has been replaced with:

1. **`test_api_fast.py`** - Fast unit tests with fixtures
2. **`test_integration.py`** - Minimal integration tests  
3. **`fixtures/`** - Pre-generated test data

The original tests are preserved in `test_api.py.old` if needed for reference.
